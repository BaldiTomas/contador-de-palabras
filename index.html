<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contador de Palabras</title>
  <!-- Bootstrap CSS (opcional) -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>

  <!-- React y ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  
  <!-- Babel para JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- El componente en JSX -->
  <script type="text/babel">
    const { useState } = React;

    function ContadorDePalabras() {
      const [results, setResults] = useState({});
      const [error, setError] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [progress, setProgress] = useState(0);

      const handleSubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(event.currentTarget);
        const files = formData.getAll('files');

        if (files.length === 0) {
          setError('Por favor, selecciona al menos un archivo.');
          return;
        }

        if (files.length > 5) {
          setError('Solo puedes subir hasta 5 archivos.');
          return;
        }

        setIsLoading(true);
        setError('');
        setProgress(0);

        try {
          const response = await fetch('https://contadorconcurrente-1.onrender.com/count-words', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            throw new Error('Error al procesar los archivos');
          }

          const data = await response.json();
          setResults(data);
          setProgress(100);
        } catch (err) {
          setError('Hubo un error al procesar los archivos. Por favor, intenta de nuevo.');
          console.error(err);
        } finally {
          setIsLoading(false);
        }
      };

      return (
        <div className="container min-vh-100 d-flex align-items-center justify-content-center">
          <div className="card w-100" style={{ maxWidth: '500px' }}>
            <div className="card-header">
              <h5>Contador de Palabras</h5>
              <p className="text-muted">Sube hasta 5 archivos .txt para contar las palabras en cada uno</p>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit} className="space-y-4">
                <div className="form-group">
                  <div className="d-flex flex-column align-items-center justify-content-center border border-dashed rounded-lg p-4">
                    <input
                      type="file"
                      name="files"
                      accept=".txt"
                      multiple
                      className="form-control-file"
                      onChange={() => setError('')}
                    />
                    <small className="form-text text-muted mt-2">Arrastra archivos aqu√≠ o haz clic para seleccionar</small>
                  </div>
                </div>

                {error && (
                  <div className="alert alert-danger" role="alert">
                    {error}
                  </div>
                )}

                {isLoading && (
                  <div className="progress">
                    <div className="progress-bar" role="progressbar" style={{ width: `${progress}%` }}></div>
                  </div>
                )}

                {Object.keys(results).length > 0 && (
                  <div className="alert alert-primary mt-3">
                    <h6>Resultados:</h6>
                    {Object.entries(results).map(([filename, count]) => (
                      <div key={filename} className="d-flex justify-content-between">
                        <span>{filename}:</span>
                        <span>{count} palabras</span>
                      </div>
                    ))}
                  </div>
                )}

                <button type="submit" className="btn btn-primary w-100" disabled={isLoading}>
                  {isLoading ? 'Procesando...' : 'Contar Palabras'}
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<ContadorDePalabras />, document.getElementById('root'));
  </script>
</body>
</html>
